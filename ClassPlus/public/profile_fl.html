<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <style>
        /* Adding some styles to remove the default blue color and underline of the anchor tag */
        a {
            color: inherit;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline; /* Optional: underline on hover for better user experience */
        }

        .userInput{
            background-color: #D9D9D9;
            font-size: 15px;
            border: 0px;
        }
    </style>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" 
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.min.js" 
        integrity="sha512-quHCp3WbBNkwLfYUMd+KwBAgpVukJu5MncuQaWXgCrfgcxCJAq/fo+oqrRKOj+UKEmyMCG3tb8RB63W+EmrOBg==" crossorigin="anonymous"></script>
</head>
<body>
  
  <nav>
    <div style="width: 100%; height: 100%; position: relative; background: white">
        <div style="width: 1440px; height: 87px; left: 0px; top: 0px; position: absolute; background: #004F34; justify-content: flex-start; align-items: flex-start; display: inline-flex">
            <div style="width: 1430px; height: 87px; padding-left: 16px; padding-right: 16px; padding-top: 8px; padding-bottom: 8px; background: #004F34; justify-content: space-between; align-items: center; display: flex">
                <div style="width: 70px; height: 71px; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25); border-radius: 100px; flex-direction: column; justify-content: center; align-items: center; display: inline-flex">
                    <a href="index.html"><img style="width: 70px; height: 71px" src="C_logo.png" /></a>
                </div>
                <div style="justify-content: flex-start; align-items: center; gap: 8px; display: flex">
                    <a href="course_page_homepage.html">
                        <div style="padding-left: 16px; padding-right: 16px; padding-top: 6px; padding-bottom: 6px; color: #F8F9FA; font-size: 16px; font-family: Inter; font-weight: 400; line-height: 28px; word-wrap: break-word">
                            My Courses
                        </div>
                    </a>
                    <a href="study_group_current.html">
                        <div style="padding-left: 16px; padding-right: 16px; padding-top: 6px; padding-bottom: 6px; color: #F8F9FA; font-size: 16px; font-family: Inter; font-weight: 400; line-height: 28px; word-wrap: break-word">
                            My Groups
                        </div>
                    </a>
                    <a href="study_group_find.html">
                        <div style="padding-left: 16px; padding-right: 16px; padding-top: 6px; padding-bottom: 6px; color: #CED4DA; font-size: 16px; font-family: Inter; font-weight: 400; line-height: 28px; word-wrap: break-word">
                            Find group
                        </div>
                    </a>
                    <a href="study_group_creating.html">
                        <div style="padding-left: 16px; padding-right: 16px; padding-top: 6px; padding-bottom: 6px; color: #CED4DA; font-size: 16px; font-family: Inter; font-weight: 400; line-height: 28px; word-wrap: break-word">
                            Create Group
                        </div>
                    </a>
                    <a href="profile.html">
                        <div style="padding-left: 16px; padding-right: 16px; padding-top: 6px; padding-bottom: 6px; color: #D9E4E1; font-size: 16px; font-family: Inter; font-weight: 400; line-height: 28px; word-wrap: break-word">
                            Profile
                        </div>
                    </a>
                    <a id="linkforloginout" href="">
                        <div id="loginout" style="padding-left: 16px; padding-right: 16px; padding-top: 6px; padding-bottom: 6px; color: #D9E4E1; font-size: 16px; font-family: Inter; font-weight: 400; line-height: 28px; word-wrap: break-word">
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
    </nav>

    
    <!--Back Button-->
    <div style="left: 15px; top: 124px; position: absolute; justify-content: flex-start; align-items: flex-start; display: inline-flex">
      <a href="javascript:void(0);" onclick="window.history.back();" style="text-decoration: none;">
          <div style="padding-left: 16px; padding-right: 16px; padding-top: 10px; padding-bottom: 10px; background: #004F34; border-radius: 4px; justify-content: flex-start; align-items: center; display: flex">
              <div style="text-align: center; color: #F5F5F5; font-size: 16px; font-family: Inter; font-weight: 600; word-wrap: break-word">Back</div>
          </div>
      </a>
    </div>  
    
    <div style="width: 348px; height: 182px; left: 100px; top: 200px; position: absolute">
      <div
          style="width: 348px; height: 41px; padding-left: 16px; padding-right: 16px; padding-top: 8px; padding-bottom: 8px; left: 0px; top: 0px; position: absolute; background: white; flex-direction: column; justify-content: flex-start; align-items: flex-start; display: inline-flex">
          <a href="profile.html">
          <div
              style="width: 111px; color: #343A40; font-size: 14px; font-family: Inter; font-weight: 700; line-height: 16px; word-wrap: break-word">
              Information</div></a>
      </div>
      <div
          style="width: 348px; height: 42px; padding-left: 16px; padding-right: 16px; padding-top: 8px; padding-bottom: 8px; left: 0px; top: 46px; position: absolute; background: white; flex-direction: column; justify-content: flex-start; align-items: flex-start; display: inline-flex">
          <a href="profile_ci.html">
          <div
              style="color: #343A40; font-size: 14px; font-family: Inter; font-weight: 600; line-height: 16px; word-wrap: break-word">
              Class Information</div></a>
      </div>
      <div
          style="width: 348px; height: 42px; padding-left: 16px; padding-right: 16px; padding-top: 8px; padding-bottom: 8px; left: 0px; top: 92px; position: absolute; background: #004F34; flex-direction: column; justify-content: flex-start; align-items: flex-start; display: inline-flex">
          <a href="profile_fl.html">
          <div
              style="color: white; font-size: 14px; font-family: Inter; font-weight: 600; line-height: 16px; word-wrap: break-word">
              Friend List</div></a>
      </div>
      <div
          style="width: 348px; height: 42px; padding-left: 16px; padding-right: 16px; padding-top: 8px; padding-bottom: 8px; left: 0px; top: 140px; position: absolute; background: white; flex-direction: column; justify-content: flex-start; align-items: flex-start; display: inline-flex">
          <a href="profile_cp.html">
          <div
              style="color: #343A40; font-size: 14px; font-family: Inter; font-weight: 600; line-height: 16px; word-wrap: break-word">
              Change Password</div></a>
      </div>
    </div>

    <div
      style="
        width: 625px;
        height: 531px;
        left: 500px;
        top: 170px;
        position: absolute;
      "
    >
    <div
      style="
        left: 0px;
        top: 0px;
        position: absolute;
        color: black;
        font-size: 20px;
        font-family: Inter;
        font-weight: 400;
        line-height: 28px;
        word-wrap: break-word;
      "
    >
      <div id="welcome"></div>
    </div>

      <div
        style="
          left: 0px;
          top: 58px;
          position: absolute;
          color: black;
          font-size: 20px;
          font-family: Inter;
          font-weight: 400;
          line-height: 28px;
          word-wrap: break-word;
        "
      >
        Friend List
      </div>

      <div id="frame">
        <div
          style="
            width: 625px;
            height: 442px;
            left: 0px;
            top: 89px;
            position: absolute;
            background: #d9d9d9;
          "
        >
        </div>

        <div
          style="
            left: 117px;
            top: 124px;
            position: absolute;
            color: black;
            font-size: 20px;
            font-family: Inter;
            font-weight: 400;
            line-height: 28px;
            word-wrap: break-word;
          "
        >
          <div id="friendList"></div>
        </div>
      </div>
    </div>

    
      <script>
        function isTokenValid() {  
            const token = localStorage.getItem('jwt'); 
            const exp = localStorage.getItem('exp');

            if (!token) {
                console.log("No token");
                return false;
            }
            try {
                if (Date.now() >= exp * 1000) {
                    console.log("Token is expired");
                    localStorage.removeItem("jwt");
                    localStorage.removeItem("exp");
                    localStorage.removeItem("firstName");
                    localStorage.removeItem("lastName");
                    location.replace('/');
                    return false;
                }
            } catch (err) {
                console.log("Token is invalid");
                return false;
            }
            return true;
        }

        function onLoad() {
            const token = localStorage.getItem('jwt');
            const exp = localStorage.getItem('exp');
            const userId = localStorage.getItem('userId');
            const linkElement = document.getElementById('linkforloginout');
            
            if(!userId || userId === undefined){
                document.querySelector('#loginout').innerHTML = "Login";
                linkElement.href = 'login.html';
                location.replace('login.html');
            }else{
                document.querySelector('#loginout').innerHTML = "Log out";
                linkElement.href = '#';
                linkElement.onclick = function() {
                    localStorage.removeItem('userId');
                    location.replace('index.html');
                };
            }

            const firstName = localStorage.getItem('firstName');
            const lastName = localStorage.getItem('lastName');
            document.querySelector('#welcome').innerHTML = `Hello ${firstName} ${lastName}!`;

            isTokenValid();
            axios.get(`/api/profile_fl/${userId}`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            }).then(res => {
                console.log(res.data);

                let friends = {};
                for(var i=0; i < res.data.length; i++){
                  var friendName = res.data[i].firstName + " " + res.data[i].lastName;
                  if(friends[friendName] == undefined){
                    friends[friendName] = res.data[i].subject + " " + res.data[i].courseNumber;
                  }else{
                    friends[friendName] += " and more"
                  }                  
                }

                document.querySelector('#friendList').innerHTML = "";
                for (let key in friends) {
                  console.log(key + ": " + friends[key]);
                  if(friends[key] == 'null null'){
                    document.querySelector('#friendList').innerHTML += key + "<br><br>";
                  }else{
                    document.querySelector('#friendList').innerHTML += key + " (" + friends[key] + ")<br><br>";
                  }
                }
            })         
        }

        onLoad();
    </script>
  </body>
</html>